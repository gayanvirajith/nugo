<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
	    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	    <title>{% if page.title %}{{ page.title }}{% else %}{{ site.harmony.name }}{% endif %}</title>
	    <meta name="viewport" content="width=device-width, initial-scale=1">        
	    <meta name="description" content="{% if page.meta_description %}{{ page.meta_description }}{% else %}{{ site.harmony.meta_description }}{% endif %}">
	    <link rel="canonical" 
	    href="{{ page.url | replace:'index.html','' | prepend: site.baseurl | prepend: site.url }}">
	    
	    <!-- Harmony styles -->
	    <link rel="stylesheet" type="text/css" href="{{ site.baseurl }}/assets/css/main.css">

	    <!-- Modernizr js -->
	    <script src="{{ site.baseurl }}/assets/js/modernizr.js"></script>
	    <!-- IE Fxes -->
        
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
        <style type="text/css"></style>
	</head>
    <body>
		<div id="main-container">
		    <div class="topping"></div>
			<div class="content-wrapper">
				{% include sidebar.html %}
			    <div class="content">
			    	<div class="content-container">
				    	{{ content }}
			    	</div>
			    </div>	
			</div>
		</div>
		<!-- jQuery -->
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script> 
        <!-- When no internet load JQuery from local -->
        <script>window.jQuery || document.write('<script src="{{ site.baseurl }}/assets/js/jquery.min.js"><\/script>')</script>
		<script type="text/javascript">
            // noprotect
            var CSSCriticalPath = function(w, d, opts) {
              var opt = opts || {};
              var css = {};
              var pushCSS = function(r) {
                if(!!css[r.selectorText] === false) css[r.selectorText] = {};
                var styles = r.style.cssText.split(/;(?![A-Za-z0-9])/);
                for(var i = 0; i < styles.length; i++) {
                  if(!!styles[i] === false) continue;
                  var pair = styles[i].split(": ");
                  pair[0] = pair[0].trim(); 
                  pair[1] = pair[1].trim();
                  css[r.selectorText][pair[0]] = pair[1];
                }
              };
              
              var parseTree = function() { 
                // Get a list of all the elements in the view.
                var height = w.innerHeight;
                var walker = d.createTreeWalker(d.body, NodeFilter.SHOW_ELEMENT, function(node) { return NodeFilter.FILTER_ACCEPT; }, true);

                while(walker.nextNode()) {
                  var node = walker.currentNode;
                  var rect = node.getBoundingClientRect();
                  if(rect.top < height || opt.scanFullPage) {
                    var rules = w.getMatchedCSSRules(node);
                    if(!!rules) {
                      for(var r = 0; r < rules.length; r++) {
                        pushCSS(rules[r]); 
                      }
                    }
                  } 
                }
              };
             
              this.generateCSS = function() {
                var finalCSS = "";
                for(var k in css) {
                  finalCSS += k + " { ";
                  for(var j in css[k]) {
                    finalCSS += j + ": " + css[k][j] + "; ";
                  }
                  finalCSS += "}\n";
                }
                
                return finalCSS;
              };
              
              parseTree();
            };

            window.onload = function() {
              var cp = new CSSCriticalPath(window, document, { scanFullPage: false});
              var css = cp.generateCSS();
              $('style').html(css);
            
            };
        </script>
    </body>
</html>
